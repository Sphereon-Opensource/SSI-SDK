openapi: 3.0.0
info:
  title: KMS REST Server API
  version: 0.0.1
  description: |
    A REST API for managing cryptographic keys and performing signing and verification operations.
  contact:
    name: Sphereon International B.V.
    email: support@sphereon.com
    url: 'https://sphereon.com'
servers:
  - url: http://localhost:8080/api/kms/v1
    description: Development serverfv
tags:
  - name: Providers
    description: Operations related to Key Management Systems (KMS) providers configuration.
  - name: KMS
    description: Operations related to Key Management Systems (KMS), keys and providers.
  - name: Resolvers
    description: Operations related to key resolver services for resolving cryptographic keys.
  - name: Signatures
    description: Operations for creating and verifying cryptographic signatures.
paths:
  /providers:
    get:
      tags: [ Providers ]
      summary: List configured Key Providers
      operationId: listKeyProviders
      responses:
        '200':
          description: A list of Key Provider configurations.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ListKeyProvidersResponse'
        '500':
          $ref: '#/components/responses/InternalServerError'
  #    post:
  #      tags: [ Providers ]
  #      summary: Create a new Key Provider
  #      operationId: createKeyProvider
  #      requestBody:
  #        $ref: '#/components/requestBodies/CreateKeyProviderRequest'
  #      responses:
  #        '201':
  #          description: Key Provider created successfully.
  #          content:
  #            application/json:
  #              schema:
  #                $ref: '#/components/schemas/KeyProvider'
  #        '400':
  #          $ref: '#/components/responses/BadRequest'
  #        '500':
  #          $ref: '#/components/responses/InternalServerError'

  /providers/{providerId}:
    parameters:
      - $ref: '#/components/parameters/ProviderId'
    get:
      tags: [ Providers ]
      summary: Get Key Provider details
      operationId: getKeyProvider
      responses:
        '200':
          description: Key Provider details retrieved successfully.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/KeyProvider'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  #    put:
  #      tags: [ Providers ]
  #      summary: Update Key Provider configuration
  #      operationId: updateKeyProvider
  #      requestBody:
  #        $ref: '#/components/requestBodies/UpdateKeyProviderRequest'
  #      responses:
  #        '200':
  #          description: Key Provider updated successfully.
  #          content:
  #            application/json:
  #              schema:
  #                $ref: '#/components/schemas/KeyProvider'
  #        '400':
  #          $ref: '#/components/responses/BadRequest'
  #        '404':
  #          $ref: '#/components/responses/NotFound'
  #        '500':
  #          $ref: '#/components/responses/InternalServerError'
  #    delete:
  #      tags: [ Providers ]
  #      summary: Delete Key Provider
  #      operationId: deleteKeyProvider
  #      responses:
  #        '204':
  #          description: Key Provider deleted successfully.
  #        '404':
  #          $ref: '#/components/responses/NotFound'
  #        '500':
  #          $ref: '#/components/responses/InternalServerError'

  /providers/{providerId}/keys:
    parameters:
      - $ref: '#/components/parameters/ProviderId'
    get:
      tags: [ Providers ]
      summary: List all managed cryptographic keys for a provider
      operationId: providerListKeys
      responses:
        '200':
          description: A list of all managed keys
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ListKeysResponse'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
    post:
      tags: [ Providers ]
      summary: Store a resolved cryptographic key into the KMS
      operationId: providerStoreKey
      requestBody:
        $ref: '#/components/requestBodies/StoreKeyRequest'
      responses:
        '201':
          description: Key stored successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ManagedKeyInfo'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /providers/{providerId}/keys/generate:
    parameters:
      - $ref: '#/components/parameters/ProviderId'
    post:
      tags: [ Providers ]
      summary: Generate a new key
      operationId: providerGenerateKey
      requestBody:
        $ref: '#/components/requestBodies/GenerateKeyRequest'
      responses:
        '201':
          description: Key generated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ManagedKeyPair'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /providers/{providerId}/keys/{aliasOrKid}:
    parameters:
      - $ref: '#/components/parameters/ProviderId'
      - $ref: '#/components/parameters/AliasOrKid'
    get:
      tags: [ Providers ]
      summary: Get a specific managed key by alias or kid
      operationId: providerGetKey
      responses:
        '200':
          description: The managed key for the specified provider
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ManagedKeyInfo'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
    #    put:
    #      tags: [ Providers ]
    #      summary: Update a stored key (reserved for future use)
    #      operationId: updateKey
    #      requestBody:
    #        $ref: '#/components/requestBodies/UpdateKeyRequest'
    #      responses:
    #        '200':
    #          description: Key updated successfully
    #          content:
    #            application/json:
    #              schema:
    #                $ref: '#/components/schemas/ManagedKeyInfo'
    #        '400':
    #          $ref: '#/components/responses/BadRequest'
    #        '404':
    #          $ref: '#/components/responses/NotFound'
    #        '500':
    #          $ref: '#/components/responses/InternalServerError'
    delete:
      tags: [ Providers ]
      summary: Delete a key from the key store
      operationId: providerDeleteKey
      responses:
        '204':
          description: Key deleted successfully
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  #  /providers/{providerId}/signatures/simple:
  #    parameters:
  #      - $ref: '#/components/parameters/ProviderId'
  #    post:
  #      tags: [ Signatures ]
  #      summary: Create a digital signature
  #      operationId: createSimpleSignature
  #      requestBody:
  #        $ref: '#/components/requestBodies/CreateSimpleSignatureRequest'
  #      responses:
  #        '201':
  #          description: Signature created successfully
  #          content:
  #            application/json:
  #              schema:
  #                $ref: '#/components/schemas/SignOutput'
  #        '400':
  #          $ref: '#/components/responses/BadRequest'
  #        '404':
  #          $ref: '#/components/responses/NotFound'
  #        '500':
  #          $ref: '#/components/responses/InternalServerError'
  #
  #  /providers/{providerId}/signatures/simple/verify:
  #    parameters:
  #      - $ref: '#/components/parameters/ProviderId'
  #    post:
  #      tags: [ Signatures ]
  #      summary: Verify a digital signature
  #      operationId: isValidSimpleSignature
  #      requestBody:
  #        $ref: '#/components/requestBodies/VerifySimpleSignatureRequest'
  #      responses:
  #        '200':
  #          description: Signature verification performed successfully
  #          content:
  #            application/json:
  #              schema:
  #                $ref: '#/components/schemas/SignatureVerificationResponse'
  #        '400':
  #          $ref: '#/components/responses/BadRequest'
  #        '500':
  #          $ref: '#/components/responses/InternalServerError'

  /signatures/raw/create:
    post:
      tags: [ Signatures ]
      summary: Create a raw signature
      operationId: createRawSignature
      requestBody:
        $ref: '#/components/requestBodies/CreateRawSignatureRequest'
      responses:
        '201':
          description: Signature created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CreateSignatureResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /signatures/raw/verify:
    post:
      tags: [ Signatures ]
      summary: Verify a raw signature
      operationId: isValidRawSignature
      requestBody:
        $ref: '#/components/requestBodies/VerifyRawSignatureRequest'
      responses:
        '200':
          description: Signature verification performed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SignatureVerificationResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /resolvers:
    get:
      tags: [ Resolvers ]
      summary: List all configured Key Resolvers
      operationId: listResolvers
      responses:
        '200':
          description: A list of Key Resolver configurations.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ListResolversResponse'

  /resolvers/{resolverId}:
    parameters:
      - $ref: '#/components/parameters/ResolverId'
    get:
      tags: [ Resolvers ]
      summary: Get Key Resolver details
      operationId: getResolver
      responses:
        '200':
          description: Key Resolver details retrieved successfully.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/KeyResolver'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /resolvers/{resolverId}/resolve:
    parameters:
      - $ref: '#/components/parameters/ResolverId'
    post:
      tags: [ Resolvers ]
      summary: Resolve a public key
      operationId: resolveKey
      requestBody:
        $ref: '#/components/requestBodies/ResolvePublicKeyRequest'
      responses:
        '200':
          description: Key resolved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ResolvedKeyInfo'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /keys:
    get:
      tags: [ KMS ]
      summary: List all managed cryptographic keys across all providers
      operationId: listKeys
      parameters:
        - name: providerId
          in: query
          required: false
          schema:
            type: string
          description: Optional provider ID to filter keys by provider
          example: "4895d0cf-2061-41cb-8fd4-13af5724569e"
      responses:
        '200':
          description: A list of all managed keys
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ListKeysResponse'
        '500':
          $ref: '#/components/responses/InternalServerError'
    post:
      tags: [ KMS ]
      summary: Store a resolved cryptographic key (providerId and alias from keyInfo)
      operationId: storeKey
      requestBody:
        $ref: '#/components/requestBodies/StoreKeyByInfoRequest'
      responses:
        '201':
          description: Key stored successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ManagedKeyInfo'
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /keys/generate:
    post:
      tags: [ KMS ]
      summary: Generate a new key (with optional providerId in body)
      operationId: generateKey
      requestBody:
        $ref: '#/components/requestBodies/GenerateKeyGlobalRequest'
      responses:
        '201':
          description: Key generated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ManagedKeyPair'
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /keys/{aliasOrKid}:
    parameters:
      - $ref: '#/components/parameters/AliasOrKid'
      - name: providerId
        in: query
        required: false
        schema:
          type: string
        description: Optional provider ID to filter the key lookup
        example: "4895d0cf-2061-41cb-8fd4-13af5724569e"
    get:
      tags: [ KMS ]
      summary: Get a specific managed key by alias or kid
      operationId: getKey
      responses:
        '200':
          description: The managed key
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ManagedKeyInfo'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
    delete:
      tags: [ KMS ]
      summary: Delete a key from the key store by alias or kid
      operationId: deleteKey
      responses:
        '204':
          description: Key deleted successfully
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

components:
  parameters:
    ProviderId:
      name: providerId
      in: path
      required: true
      schema:
        type: string
      description: Unique identifier of the Key Provider.
      style: simple
      example: "4895d0cf-2061-41cb-8fd4-13af5724569e"

    AliasOrKid:
      name: aliasOrKid
      in: path
      required: true
      schema:
        type: string
      description: Either a Key alias or kid value
      style: simple
      example: "my-alias"

    ResolverId:
      name: resolverId
      in: path
      required: true
      schema:
        type: string
      description: Unique identifier of the Key Resolver.
      style: simple
      example: "4895d0cf-2061-41cb-8fd4-13af5724569e"

  requestBodies:
    CreateKeyProviderRequest:
      description: Request body for creating a new Key Provider.
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/CreateKeyProvider'

    UpdateKeyProviderRequest:
      description: Request body for updating an existing Key Provider.
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/UpdateKeyProvider'

    GenerateKeyRequest:
      description: Request body for generating a new key.
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/GenerateKey'

    CreateSimpleSignatureRequest:
      description: Request body for creating a digital signature.
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/CreateSimpleSignature'

    VerifySimpleSignatureRequest:
      description: Request body for verifying a digital signature.
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/VerifySimpleSignature'

    CreateRawSignatureRequest:
      description: Request body for creating a raw signature.
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/CreateRawSignature'

    VerifyRawSignatureRequest:
      description: Request body for verifying a raw signature.
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/VerifyRawSignature'

    StoreKeyRequest:
      description: Request body for storing a key.
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/StoreKey'

    ResolvePublicKeyRequest:
      description: Request body for resolving a public key.
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ResolvePublicKey'

    StoreKeyByInfoRequest:
      description: Request body for storing a key by info.
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/StoreKey'

    GenerateKeyGlobalRequest:
      description: Request body for generating a key globally.
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/GenerateKeyGlobal'

  responses:
    BadRequest:
      description: Bad request due to invalid input parameters or request body.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

    NotFound:
      description: The requested resource was not found.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

    InternalServerError:
      description: An unexpected error occurred on the server.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

  schemas:
    AwsAssumeRoleCredentials:
      description: Credentials obtained by assuming an IAM role.
      type: object
      required:
        - roleArn
        - roleSessionName
      properties:
        roleArn:
          type: string
          description: The Amazon Resource Name (ARN) of the role to assume.
          example: "arn:aws:iam::123456789012:role/MyKmsAccessRole"
        roleSessionName:
          type: string
          description: An identifier for the assumed role session. Use characters compatible with file systems.
          example: "kms-rest-session"
        externalId:
          type: string
          description: An optional external ID that might be required by the role's trust policy.
          example: "unique-external-id-123"
        lookupMode:
          $ref: '#/components/schemas/LookupMode'

    AwsClientConfiguration:
      description: Optional advanced AWS SDK client settings.
      type: object
      properties:
        connectionTimeoutInMillis:
          type: integer
          format: int32
          description: Amount of time (in milliseconds) to wait when initially establishing a connection before giving up.
          example: 2000
        socketTimeoutInMillis:
          type: integer
          format: int32
          description: Amount of time (in milliseconds) to wait for data to be transferred over an established, open connection before timing out.
          example: 5000

    AwsKmsSetting:
      description: >-
        Configuration settings specific to the AWS_KMS provider type.
        Defines how to connect and authenticate to AWS KMS.
        If no specific credential provider is specified,
        the implementation should rely on the default AWS SDK credential provider chain.
      type: object
      required:
        - region
      properties:
        region:
          type: string
          description: The AWS region where the KMS keys reside (e.g., 'us-east-1', 'eu-west-1').
          example: "eu-west-1"
        staticCredentials:
          $ref: '#/components/schemas/AwsStaticCredentials'
        assumeRoleCredentials:
          $ref: '#/components/schemas/AwsAssumeRoleCredentials'
        webIdentityTokenCredentials:
          $ref: '#/components/schemas/AwsWebIdentityTokenCredentials'
        endpointUrl:
          type: string
          format: uri
          description: Optional custom endpoint URL for AWS KMS (e.g., for VPC endpoints or local testing).
          example: "https://kms.eu-west-1.amazonaws.com"
        clientConfiguration:
          $ref: '#/components/schemas/AwsClientConfiguration'

    AwsStaticCredentials:
      description: Explicit AWS access key ID and secret access key. Use with caution; prefer IAM roles or other mechanisms where possible.
      type: object
      required:
        - accesskid
        - secretAccessKey
      properties:
        accesskid:
          type: string
          description: AWS Access Key ID.
          example: "AKIAIOSFODNN7EXAMPLE"
        secretAccessKey:
          type: string
          format: password
          description: AWS Secret Access Key.
          example: "wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY"
          writeOnly: true
        sessionToken:
          type: string
          format: password
          description: Optional AWS session token, typically used with temporary credentials.
          example: "AQoDYXdzEPT//////////wEXAMPLEtcAQ..."
          writeOnly: true
        lookupMode:
          $ref: '#/components/schemas/LookupMode'

    AwsWebIdentityTokenCredentials:
      description: Credentials obtained using a web identity token (e.g., from Cognito, OIDC provider).
      type: object
      required:
        - roleArn
        - roleSessionName
        - webIdentityToken
      properties:
        roleArn:
          type: string
          description: The Amazon Resource Name (ARN) of the role to assume.
          example: "arn:aws:iam::123456789012:role/MyKmsWebRole"
        roleSessionName:
          type: string
          description: An identifier for the assumed role session.
          example: "kms-web-session"
        webIdentityToken:
          type: string
          format: password
          description: The web identity token (e.g., OIDC token, Cognito token) itself.
          example: "eyJhbGciOiJSUzI1NiIsImtpZCI6Ims..."
          writeOnly: true
        lookupMode:
          $ref: '#/components/schemas/LookupMode'

    AzureClientSecretCredentialOpts:
      description: Azure Service Principal credentials using a client secret.
      type: object
      required:
        - clientId
        - clientSecret
      properties:
        clientId:
          type: string
          description: The Application (client) ID of the Azure service principal.
          example: "cfa45c7f-1212-7a59-ac45-aa82acec4364343"
        clientSecret:
          type: string
          format: password
          description: The client secret for the service principal.
          example: "your-azure-client-secret"
          writeOnly: true
        lookupMode:
          $ref: '#/components/schemas/LookupMode'

    AzureCredentialOpts:
      description: Azure credential options for authenticating to Key Vault. Currently assumes Service Principal with Client Secret.
      type: object
      properties:
        clientSecretCredentialOpts:
          $ref: '#/components/schemas/AzureClientSecretCredentialOpts'

    AzureKeyVaultSetting:
      description: Configuration settings specific to the Azure KeyVault provider type.
      type: object
      required:
        - keyvaultUrl
        - tenantId
        - credentialOpts
      properties:
        keyvaultUrl:
          type: string
          format: uri
          description: The URL of the Azure Key Vault or Managed HSM instance.
          example: 'https://example-vault.vault.azure.net/'
        tenantId:
          type: string
          description: The Azure Active Directory tenant (directory) ID.
          example: "a3b42c5a-5512-4379-bc27-4682acec459a"
        credentialOpts:
          $ref: '#/components/schemas/AzureCredentialOpts'
        applicationId:
          type: string
          description: An optional identifier for your application using the Key Vault.
          example: "my-kms-rest-app"
        lookupMode:
          $ref: '#/components/schemas/LookupMode'

    CoseKeyPair:
      type: object
      description: Represents a cryptographic key pair for COSE (CBOR Object Signing and Encryption) operations.
      required:
        - publicCoseKey
      properties:
        privateCoseKey:
          $ref: '#/components/schemas/CoseKey'
        publicCoseKey:
          $ref: '#/components/schemas/CoseKey'

    CreateKeyProvider:
      description: Request body for creating a new Key Provider instance.
      type: object
      required:
        - type
      properties:
        type:
          $ref: '#/components/schemas/KeyProviderType'
        azureKeyvaultSettings:
          $ref: '#/components/schemas/AzureKeyVaultSetting'
        awsKmsSettings:
          $ref: '#/components/schemas/AwsKmsSetting'
        cacheEnabled:
          type: boolean
          description: Whether to enable caching for keys retrieved from this provider.
          default: false
        cacheTTLInSeconds:
          type: integer
          format: int32
          description: Time-to-live for cached keys in seconds (if cacheEnabled is true).
          default: 300
          minimum: 0

    CreateRawSignature:
      description: Request body for creating a raw signature.
      type: object
      required:
        - keyInfo
        - input
      properties:
        keyInfo:
          $ref: '#/components/schemas/KeyInfo'
        input:
          type: string
          format: byte

    CreateSimpleSignature:
      description: Request body for creating a digital signature.
      type: object
      required:
        - signInput
        - keyInfo
      properties:
        signInput:
          $ref: '#/components/schemas/SignInput'
        keyInfo:
          $ref: '#/components/schemas/KeyInfo'
        signatureAlgorithm:
          $ref: '#/components/schemas/SignatureAlgorithm'

    CryptoAlg:
      type: string
      description: Cryptographic algorithm type.
      enum:
        - ED25519
        - ECDSA
        - HMAC
        - RSA
      example: ECDSA

    Curve:
      type: string
      description: Elliptic curve identifier.
      enum:
        - P-256
        - P-384
        - P-521
        - secp256k1
        - Ed25519
        - Ed448
        - X25519
        - X448
      example: P-256

    DigestAlg:
      type: string
      description: Cryptographic digest (hash) algorithm identifier.
      enum:
        - NONE
        - SHA256
        - SHA384
        - SHA512
        - SHA3_256
        - SHA3_384
        - SHA3_512
      example: SHA256

    ErrorResponse:
      type: object
      required:
        - code
        - message
      properties:
        code:
          type: string
          description: Error code identifying the type of error.
        message:
          type: string
          description: Human-readable error message.
        details:
          type: object
          description: Additional error details.
          additionalProperties: true

    GenerateKey:
      type: object
      description: Parameters for key generation.
      properties:
        use:
          $ref: '#/components/schemas/JwkUse'
        keyOperations:
          type: array
          items:
            $ref: '#/components/schemas/KeyOperations'
        curve:
          $ref: '#/components/schemas/Curve'
        alg:
          $ref: '#/components/schemas/SignatureAlgorithm'

    JoseKeyPair:
      type: object
      description: Data class representing a cryptographic key pair used with JOSE (JSON Object Signing and Encryption).
      required:
        - publicJwk
      properties:
        privateJwk:
          $ref: '#/components/schemas/Jwk'
        publicJwk:
          $ref: '#/components/schemas/Jwk'

    JwkUse:
      type: string
      description: Intended use of the key (signing or encryption).
      enum:
        - sig
        - enc
      example: sig

    JwkKeyType:
      type: string
      description: JSON Web Key (JWK) key type parameter identifying the cryptographic algorithm family.
      enum:
        - EC
        - RSA
        - OKP
        - oct
      example: EC

    Jwk:
      type: object
      description: Represents a JSON Web Key (JWK) as defined by the JSON Web Key specification.
      required:
        - kty
      properties:
        kty:
          $ref: '#/components/schemas/JwkKeyType'
        kid:
          type: string
          description: Key identifier used to uniquely identify the key.
          example: "key-12345"
        alg:
          type: string
          description: The algorithm intended for use with the key (JWA algorithm name).
          example: "ES256"
        use:
          $ref: '#/components/schemas/JwkUse'
        key_ops:
          type: array
          items:
            $ref: '#/components/schemas/KeyOperations'
          description: The allowed cryptographic operations for the key.
        crv:
          $ref: '#/components/schemas/Curve'
        x:
          type: string
          description: The x coordinate for elliptic curve keys (base64url-encoded).
          example: "f83OJ3D2xF1Bg8vub9tLe1gHMzV76e8Tus9uPHvRVEU"
        y:
          type: string
          description: The y coordinate for elliptic curve keys (base64url-encoded).
          example: "x_FEzRu9m36HLN_tue659LNpXW6pCyStikYjKIWI5a0"
        d:
          type: string
          format: password
          description: The private key parameter (base64url-encoded).
          writeOnly: true
        n:
          type: string
          description: The modulus value for RSA keys (base64url-encoded).
        e:
          type: string
          description: The public exponent for RSA keys (base64url-encoded).
          example: "AQAB"
        p:
          type: string
          format: password
          description: The first prime factor for RSA private keys (base64url-encoded).
          writeOnly: true
        q:
          type: string
          format: password
          description: The second prime factor for RSA private keys (base64url-encoded).
          writeOnly: true
        dp:
          type: string
          format: password
          description: The first factor CRT exponent for RSA private keys (base64url-encoded).
          writeOnly: true
        dq:
          type: string
          format: password
          description: The second factor CRT exponent for RSA private keys (base64url-encoded).
          writeOnly: true
        qi:
          type: string
          format: password
          description: The first CRT coefficient for RSA private keys (base64url-encoded).
          writeOnly: true
        k:
          type: string
          format: password
          description: The symmetric key value (base64url-encoded).
          writeOnly: true
        x5c:
          type: array
          items:
            type: string
          description: X.509 certificate chain as base64-encoded DER certificates.
        x5t:
          type: string
          description: X.509 certificate SHA-1 thumbprint (base64url-encoded).
        x5u:
          type: string
          format: uri
          description: URL pointing to X.509 certificate or certificate chain.
        x5t#S256:
          type: string
          description: X.509 certificate SHA-256 thumbprint (base64url-encoded).

    CoseKeyType:
      type: integer
      description: COSE key type parameter. 1=OKP (Octet Key Pair), 2=EC2 (Elliptic Curve), 3=RSA, 4=Symmetric.
      enum:
        - 1
        - 2
        - 3
        - 4
      example: 2

    CoseKey:
      type: object
      description: Represents a COSE (CBOR Object Signing and Encryption) key in JSON format.
      required:
        - kty
      properties:
        kty:
          $ref: '#/components/schemas/CoseKeyType'
        kid:
          type: string
          description: Key identifier (base64url-encoded byte string).
          example: "key-12345"
        alg:
          type: integer
          description: The COSE algorithm identifier (e.g., -7=ES256, -35=ES384, -36=ES512, -8=EdDSA).
          example: -7
        key_ops:
          type: array
          items:
            type: integer
          description: The allowed COSE key operations (1=sign, 2=verify, 3=encrypt, 4=decrypt, etc.).
        baseIV:
          type: string
          description: Base initialization vector (base64url-encoded).
        crv:
          type: integer
          description: The COSE curve identifier (1=P-256, 2=P-384, 3=P-521, 8=secp256k1, 6=Ed25519, etc.).
          example: 1
        x:
          type: string
          description: The x coordinate (base64url-encoded byte string).
        y:
          type: string
          description: The y coordinate (base64url-encoded byte string).
        d:
          type: string
          format: password
          description: The private key parameter (base64url-encoded byte string).
          writeOnly: true
        x5chain:
          type: array
          items:
            type: string
          description: X.509 certificate chain as base64-encoded certificates.



    KeyInfo:
      type: object
      description: Information about a cryptographic key, providing metadata and configuration details necessary for cryptographic operations.
      properties:
        kid:
          type: string
          description: Unique identifier for the cryptographic key. Can be null if the key identifier is not provided.
          example: "key-12345"
        key:
          $ref: '#/components/schemas/Jwk'
        signatureAlgorithm:
          $ref: '#/components/schemas/SignatureAlgorithm'
        keyVisibility:
          $ref: '#/components/schemas/KeyVisibility'
        x5c:
          type: array
          items:
            type: string
          description: X.509 certificate chain associated with the key.
        alias:
          type: string
          description: A reference or alias to the key in the Key Management Service (KMS).
          example: "my-signing-key"
        providerId:
          type: string
          description: The Key Management System (KMS) identifier associated with the key.
          example: "4895d0cf-2061-41cb-8fd4-13af5724569e"
        keyType:
          $ref: '#/components/schemas/KeyType'
        keyEncoding:
          $ref: '#/components/schemas/KeyEncoding'
        opts:
          type: object
          description: Additional configuration options as key-value pairs.
          additionalProperties:
            type: string

    ResolvedKeyInfo:
      type: object
      description: Represents a resolved cryptographic key information where the key is guaranteed to be present and resolved, providing concrete access to the key.
      allOf:
        - $ref: '#/components/schemas/KeyInfo'
      required:
        - key

    ManagedKeyInfo:
      type: object
      description: Represents a managed cryptographic key information that is guaranteed to be present and resolved, part of a KMS providing concrete access to the key.
      allOf:
        - $ref: '#/components/schemas/ResolvedKeyInfo'
      required:
        - alias
        - providerId

    KeyProviderType:
      type: string
      description: >-
        The type of Key Provider. Determines the required configuration settings.
        - AZURE_KEYVAULT: Microsoft Azure Key Vault or Managed HSM.
        - AWS_KMS: Amazon Web Services Key Management Service.
      enum:
        - SOFTWARE
        - AZURE_KEYVAULT
        - AWS_KMS
      example: AZURE_KEYVAULT

    KeyOperations:
      type: string
      description: Specific operations the key is intended for.
      enum:
        - sign
        - verify
        - encrypt
        - decrypt
        - wrapKey
        - unwrapKey
        - deriveKey
        - deriveBits
      example: sign

    KeyProvider:
      description: Response body containing the details of a Key Provider instance.
      type: object
      required:
        - providerId
        - type
      properties:
        providerId:
          type: string
          description: The unique identifier assigned to the Key Provider instance upon creation.
          example: "4895d0cf-2061-41cb-8fd4-13af5724569e"
        type:
          $ref: '#/components/schemas/KeyProviderType'
    #        capabilities:
    #          $ref: '#/components/schemas/ProviderCapabilities'
    #        azureKeyvaultSettings:
    #          $ref: '#/components/schemas/AzureKeyVaultSetting'
    #        awsKmsSettings:
    #          $ref: '#/components/schemas/AwsKmsSetting'
    #        cacheEnabled:
    #          type: boolean
    #          description: Whether caching is enabled for this provider.
    #        cacheTTLInSeconds:
    #          type: integer
    #          format: int32
    #          description: Time-to-live for cached keys in seconds.

    KeyType:
      type: string
      description: Cryptographic key type identifier.
      enum:
        - OKP
        - EC
        - RSA
      example: EC

    KeyVisibility:
      type: string
      description: Indicates the visibility status of a cryptographic key.
      enum:
        - PUBLIC
        - PRIVATE
      example: PUBLIC
      default: PUBLIC

    KeyEncoding:
      type: string
      description: The encoding format of the cryptographic key.
      enum:
        - COSE
        - JOSE
      example: JOSE

    CreateSignatureResponse:
      description: Response body containing the created signature.
      type: object
      required:
        - signature
      properties:
        signature:
          type: string
          format: byte
          description: The created signature encoded as a base64 string.

    ListResolversResponse:
      description: Response body containing all the resolvers.
      type: object
      required:
        - resolvers
      properties:
        resolvers:
          type: array
          items:
            $ref: '#/components/schemas/Resolver'

    ListKeysResponse:
      description: Response body containing all the managed keys.
      type: object
      required:
        - keys
      properties:
        keys:
          type: array
          items:
            $ref: '#/components/schemas/ManagedKeyInfo'

    ListKeyProvidersResponse:
      description: Response body containing the details of a Key Provider instance.
      type: object
      required:
        - providers
      properties:
        providers:
          type: array
          items:
            $ref: '#/components/schemas/KeyProvider'

    LookupMode:
      type: string
      description: >-
        Determines how configuration values are looked up.
        - VALUE: The actual configuration values are provided directly.
        - CONFIG_SERVICE: Configuration values are looked up from a configuration service using keys.
        - SECRET_SERVICE: Configuration values are looked up from a secret service using keys.
      enum:
        - VALUE
        - CONFIG_SERVICE
        - SECRET_SERVICE
      example: VALUE

    ManagedKeyPair:
      type: object
      description: Represents a key pair used by a crypto provider, encapsulating both JOSE and COSE key pairs.
      required:
        - providerId
        - alias
        - cose
        - jose
      properties:
        kid:
          type: string
          description: Key identifier, may be null.
        providerId:
          type: string
          description: Key Management System identifier.
        alias:
          type: string
          description: Reference to the key in the KMS.
        cose:
          $ref: '#/components/schemas/CoseKeyPair'
        jose:
          $ref: '#/components/schemas/JoseKeyPair'

    MaskGenFunction:
      type: string
      description: Mask generation function algorithm.
      enum:
        - MGF1
      example: MGF1

    ProviderCapabilities:
      type: object
      description: Comprehensive information about a provider's cryptographic capabilities.
      properties:
        keyTypes:
          type: array
          description: List of key types supported by this provider.
          items:
            $ref: '#/components/schemas/KeyType'
        signatureAlgorithms:
          type: array
          description: List of signature algorithms supported by this provider.
          items:
            $ref: '#/components/schemas/SignatureAlgorithm'
        digests:
          type: array
          description: List of digest algorithms supported by this provider.
          items:
            $ref: '#/components/schemas/DigestAlg'
        curves:
          type: array
          description: List of elliptic curves supported by this provider.
          items:
            $ref: '#/components/schemas/Curve'
        keyOperations:
          type: array
          description: List of key operations supported by this provider.
          items:
            $ref: '#/components/schemas/KeyOperations'

    Signature:
      type: object
      description: A cryptographic signature including the signature value and related information.
      required:
        - value
        - algorithm
      properties:
        value:
          type: string
          format: byte
          description: The signature value, encoded as a base64 string.
        algorithm:
          $ref: '#/components/schemas/SignatureAlgorithm'
        keyInfo:
          $ref: '#/components/schemas/KeyInfo'
        metadata:
          type: object
          description: Additional metadata included in the signature.
          additionalProperties: true

    SignatureAlgorithm:
      type: string
      description: Cryptographic signature algorithm identifier.
      enum:
        - ED25519
        - ECDSA_SHA256
        - ECDSA_SHA384
        - ECDSA_SHA512
        - ES256K
        - ECKA_DH_SHA256
        - HMAC_SHA256
        - HMAC_SHA384
        - HMAC_SHA512
        - RSA_SSA_PSS_SHA256_MGF1
        - RSA_SSA_PSS_SHA384_MGF1
        - RSA_SSA_PSS_SHA512_MGF1
      example: ECDSA_SHA256

    SignInput:
      type: object
      description: The input data and metadata required for creating a signature.
      required:
        - data
      properties:
        data:
          type: string
          format: byte
          description: The data to be signed, encoded as a base64 string.
        mode:
          type: string
          description: The signing mode to be used.
          enum: [ DETACHED, ATTACHED ]
          default: DETACHED
        metadata:
          type: object
          description: Additional metadata to be included in the signature.
          additionalProperties: true

    SignOutput:
      type: object
      description: The output of a signature creation operation.
      required:
        - signature
      properties:
        signature:
          $ref: '#/components/schemas/Signature'
        metadata:
          type: object
          description: Additional metadata included in the signature output.
          additionalProperties: true

    SignatureVerificationResponse:
      description: Response body containing the details of a Key Provider instance.
      type: object
      required:
        - isValid
      properties:
        isValid:
          type: boolean
          description: Indicates whether the signature is valid or not.
          example: true

    StoreKey:
      type: object
      description: Request body for storing a key.
      required:
        - keyInfo
      properties:
        keyInfo:
          $ref: '#/components/schemas/ResolvedKeyInfo'
        certChain:
          type: array
          items:
            type: string
          description: X.509 certificate chain as base64-encoded DER certificates.

    GenerateKeyGlobal:
      type: object
      description: Parameters for global key generation with optional provider specification.
      allOf:
        - $ref: '#/components/schemas/GenerateKey'
        - type: object
          properties:
            providerId:
              type: string
              description: Optional provider ID. If not specified, the default provider will be used.
              example: "4895d0cf-2061-41cb-8fd4-13af5724569e"

    ResolvePublicKey:
      type: object
      description: Request body for resolving a public key.
      required:
        - keyInfo
      properties:
        keyInfo:
          $ref: '#/components/schemas/KeyInfo'
        identifierMethod:
          $ref: '#/components/schemas/IdentifierMethod'
        trustedCerts:
          type: array
          items:
            type: string
          description: Optional array of trusted certificates (base64-encoded) that may be used in the resolution process.
        verifyX509CertificateChain:
          type: boolean
          description: Optional boolean indicating whether the X.509 certificate chain should be verified.
          default: false

    UpdateKeyProvider:
      description: Request body for updating an existing Key Provider instance.
      type: object
      properties:
        azureKeyvaultSettings:
          $ref: '#/components/schemas/AzureKeyVaultSetting'
        awsKmsSettings:
          $ref: '#/components/schemas/AwsKmsSetting'
        cacheEnabled:
          type: boolean
          description: Whether to enable caching for keys retrieved from this provider.
        cacheTTLInSeconds:
          type: integer
          format: int32
          description: Time-to-live for cached keys in seconds (if cacheEnabled is true).
          minimum: 0

    VerifyRawSignature:
      description: Request body for verifying a raw signature.
      type: object
      required:
        - keyInfo
        - input
        - signature
      properties:
        keyInfo:
          $ref: '#/components/schemas/KeyInfo'
        input:
          type: string
          format: byte
        signature:
          type: string
          format: byte

    VerifySimpleSignature:
      description: Request body for verifying a digital signature.
      type: object
      required:
        - signInput
        - signature
      properties:
        signInput:
          $ref: '#/components/schemas/SignInput'
        signature:
          $ref: '#/components/schemas/Signature'

    Resolver:
      type: object
      description: Represents a key resolver configuration.
      required:
        - resolverId
      properties:
        resolverId:
          type: string
          description: Unique identifier for the resolver.
          example: "4895d0cf-2061-41cb-8fd4-13af5724569e"
        supportedIdentifierMethods:
          type: array
          items:
            $ref: '#/components/schemas/IdentifierMethod'
          description: List of identifier methods supported by this resolver.
        supportedKeyTypes:
          type: array
          items:
            $ref: '#/components/schemas/KeyType'
          description: List of key types supported by this resolver.

    KeyResolver:
      type: object
      description: Represents a key resolver instance with detailed configuration.
      allOf:
        - $ref: '#/components/schemas/Resolver'

    IdentifierMethod:
      type: string
      description: Method used to identify cryptographic keys.
      enum:
        - JWK
        - KID
        - COSE_KEY
        - X5C
        - DID
      example: JWK
